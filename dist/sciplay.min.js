!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("sciplay",[],i):"object"==typeof exports?exports.sciplay=i():t.sciplay=i()}(this,function(){return function(t){function i(n){if(e[n])return e[n].exports;var s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){e(1),t.exports=e(2)},function(t,i){"use strict";!function(){for(var t=0,i=["ms","moz","webkit","o"],e=0;e<i.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i,e){var n=(new Date).getTime(),s=Math.max(0,16-(n-t)),o=window.setTimeout(function(){i(n+s)},s);return t=n+s,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()},function(t,i,e){"use strict";function n(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var o=e(3),r=s(o),a=e(5),c=s(a),h=e(6),l=s(h),u=e(17),d=s(u),f=e(18),y=s(f),v=e(22),p=s(v),x=e(23),g=s(x),b=e(24),m=s(b),w=e(25),P=s(w),_=e(16),S=n(_),M=e(15),k=s(M),j=e(26),O=s(j),I=e(27),B=s(I),E=e(29),T=s(E),C=function(){return{Vector:o.Vector,vector:r.default,renderer:d.default,ray:c.default,system:l.default,wave:p.default,rect:y.default,anchor:P.default,polygon:m.default,circle:g.default,collisionTypes:T.default,constants:S,boundaryConstraint:k.default,linkConstraint:O.default,dev:{GJK:B.default}}};i.default=C,t.exports=i.default},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Vector=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=e(4),o=i.Vector=function(t,i){this.x=t||0,this.y=i||0};o.prototype={clone:function(){return new o(this.x,this.y)},set:function(t,i){return"x"===t?this.x=i:"y"===t&&(this.y=i),this},add:function(){var t=void 0,i=void 0;if(1===arguments.length){var e=arguments.length<=0?void 0:arguments[0];"object"===("undefined"==typeof e?"undefined":n(e))&&(t=e.x,i=e.y)}else 2===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&(t=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1]);return this.x+=t,this.y+=i,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},multiply:function(t){return"object"===("undefined"==typeof t?"undefined":n(t))?(this.x*=t.x,this.y*=t.y):"number"==typeof t&&(this.x*=t,this.y*=t),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magnitudeSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},rotate:function(t){var i=Math.sin(t),e=Math.cos(t),n=this.x*e-this.y*i,s=this.x*i+this.y*e;return this.x=n,this.y=s,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},angleTo:function(t){var i=this.magnitude(),e=t.magnitude(),n=this.dot(t),s=Math.acos(n/(i*e));return s},getAngle:function(t){if("DEGREES"===t)return(0,s.radToDeg)(Math.atan(this.y/this.x));var i=Math.atan2(this.y,this.x);return i<0?2*Math.PI+i:i},normalize:function(){var t=this.magnitude();return this.x/=t,this.y/=t,this},perp:function(t){if("right"===t){var i=this.x;this.x=this.y,this.y=-i}else{var e=this.x;this.x=-this.y,this.y=e}return this},distanceTo:function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},scalarProject:function(t){return this.dot(t)/t.magnitude()},scalarProjectUnit:function(t){return this.dot(t)},vectorProject:function(t){var i=this.dot(t)/t.magnitudeSq();return this.x=t.x*i,this.y=t.y*i,this},vectorProjectUnit:function(t){var i=this.dot(t);return this.x=t.x*i,this.y=t.y*i,this}},o.prototype.translate=o.prototype.add;var r=function(t,i){return new o(t,i)};o.add=function(t,i){return new o(t.x+i.x,t.y+i.y)},o.subtract=function(t,i){return new o(t.x-i.x,t.y-i.y)},o.multiply=function(t,i){return"number"==typeof t&&"number"==typeof i?t*i:"object"===("undefined"==typeof t?"undefined":n(t))&&"number"==typeof i?new o(t.x*i,t.y*i):"object"===("undefined"==typeof i?"undefined":n(i))&&"number"==typeof t?new o(t*i.x,t*i.y):new o(t.x*i.x,t.y*i.y)},o.dot=function(t,i){return t.x*i.x+t.y*i.y},o.angleBetween=function(t,i){var e=t.magnitude(),n=i.magnitude(),s=t.dot(i),o=Math.acos(s/(e*n));return o},o.perp=function(t,i){switch(i){case"right":return new o(t.y,-t.x);default:return new o(-t.y,t.x)}},o.negate=function(t){return new o(-t.x,-t.y)},i.default=r},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.degToRad=function(t){return t*Math.PI/180},i.radToDeg=function(t){return 180*t/Math.PI},i.distance=function(t,i,e,n){return Math.sqrt((e-t)*(e-t)+(n-i)*(n-i))},i.map=function(t,i,e,n,s){return n+(s-n)*(t-i)/(e-i)}},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(4),o=e(3),r=n(o),a={init:function(t,i,e,n){n&&(e=(0,s.degToRad)(e)),this.origin=(0,r.default)(t,i),this.direction=(0,r.default)(Math.cos(e),Math.sin(e)),this.invDirection=(0,r.default)(1/this.direction.x,1/this.direction.y),this.outerBodies=[],this.t=window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight;var o=this.origin.x,a=this.origin.y,c=this.origin.x+this.direction.x*this.t,h=this.origin.y+this.direction.y*this.t;this.slope=(h-a)/(c-o),this.numTests=0},trace:function(t){if(this.intersectionPoint=null,this.intersectingBody=null,this.intersectingSegment=null,this.rayID=t.currentRayId++,this.numTests=0,this.intersectHash(t.hash),this.intersectionPoint)return!0},intersectCircle:function(t){this.numTests+=1;var i=t.radius,e=(0,r.default)(this.direction.x*this.t,this.direction.y*this.t),n=o.Vector.subtract(this.origin,t.position),s=e.dot(e),a=2*n.dot(e),c=n.dot(n)-i*i,h=a*a-4*s*c;if(h<0);else{h=Math.sqrt(h);var l=(-a-h)/(2*s),u=(-a+h)/(2*s),d=void 0,f=void 0;if(l>=0&&l<=1)return d=this.origin.x+e.x*l,f=this.origin.y+e.y*l,this.updateIntersectionPoint({x:d,y:f},null,t),!0;if(u>=0&&u<=1)return d=this.origin.x+e.x*u,f=this.origin.y+e.y*u,this.updateIntersectionPoint({x:d,y:f},null,t),!0}return!1},intersectPolygon:function(t){var i=this;this.numTests+=1,t.isPointInterior(this.origin)&&this.outerBodies.push(t);var e=t.vertices,n=e.length,s=void 0;return e.forEach(function(e,o,r){var a=void 0;a=o===n-1?r[0]:r[o+1],s=i.intersectSegment([e,a]),s&&i.updateIntersectionPoint(s.intPoint,s.segVec,t)}),"undefined"!=typeof s},intersectSegment:function(t,i){var e=i?(0,r.default)(i.x*this.t,i.y*this.t):(0,r.default)(this.t*this.direction.x,this.t*this.direction.y),n=(0,r.default)(this.origin.x,this.origin.y),s=(0,r.default)(t[0].x,t[0].y),a=(0,r.default)(t[1].x-t[0].x,t[1].y-t[0].y),c=e.cross(a),h=o.Vector.subtract(s,n),l=h.cross(a),u=h.cross(e),d=void 0,f=void 0;if(0!==c&&(d=l/c,f=u/c),0!==c||0!==u){if(0===c&&0!==u)return!1;if(0!==c&&d>=0&&d<=1&&f>=0&&f<=1){var y=n.x,v=n.y,p=e.x,x=e.y,g=y+d*p,b=v+d*x;return{intPoint:(0,r.default)(g,b),segVec:a,t:d}}return!1}},intersectHash:function(t){var i=this,e=t.hash(this.origin),n=e.row,s=e.col,o=s,r=n,a=void 0,c=void 0,h=void 0,l=void 0,u=this.direction.x<0?-1:1,d=this.direction.y<0?-1:1,f=t.cellSize;for(h=f/Math.abs(this.direction.x),l=f/Math.abs(this.direction.y),a=o*f-this.origin.x,c=r*f-this.origin.y,this.direction.x>=0&&(a+=f),this.direction.y>=0&&(c+=f),a/=this.direction.x,c/=this.direction.y;r<t.numRows&&r>-1&&o<t.numCols&&o>-1;){if(window.renderer.debug&&(window.ctx.beginPath(),window.ctx.globalAlpha=1,window.ctx.strokeStyle="orange",window.ctx.lineWidth=3,window.ctx.strokeRect(o*f,r*f,f,f)),t.contents[r]&&t.contents[r][o]&&0!==t.contents[r][o].length){var y=t.contents[r][o];y.forEach(function(t){if(t.intersectionPoints[i.rayID]){if("hit"===t.intersectionPoints[i.rayID].status)return void i.updateIntersectionPoint(t.intersectionPoints[i.rayID].intPoint,t.intersectionPoints[i.rayID].segVec,t)}else{var e=i.intersectAABB(t.aabb);if(e)switch(t.type){case"polygon":case"rectangle":i.intersectPolygon(t);break;case"circle":i.intersectCircle(t)}i.intersectionPoint?t.intersectionPoints[i.rayID]={status:"hit",intPoint:i.intersectionPoint,segVeg:i.intersectingSegment}:t.intersectionPoints[i.rayID]={status:"miss"}}})}if(void 0===a&&void 0===c)break;void 0===a?(c+=l,r+=d):void 0===c?(a+=h,o+=u):a<c?(a+=h,o+=u):a>=c&&(c+=l,r+=d)}return{hashCoordinates:{x:o,y:r},intPoint:this.intersectionPoint}},intersectAABB:function(t){var i=(t.min.x-this.origin.x)*this.invDirection.x,e=(t.max.x-this.origin.x)*this.invDirection.x,n=Math.min(i,e),s=Math.max(i,e),o=(t.min.y-this.origin.y)*this.invDirection.y,r=(t.max.y-this.origin.y)*this.invDirection.y;n=Math.max(n,Math.min(o,r)),s=Math.min(s,Math.max(o,r));var a=s>=n&&s>=0;return a},updateIntersectionPoint:function(t,i,e){var n=this.origin.x,o=this.origin.y,r=t.x,a=t.y;this.intersectionPoint?(0,s.distance)(n,o,r,a)<(0,s.distance)(n,o,this.intersectionPoint.x,this.intersectionPoint.y)&&(this.intersectionPoint={x:r,y:a},this.intersectingBody=e,this.intersectingSegment=i):(this.intersectionPoint={x:r,y:a},this.intersectingBody=e,this.intersectingSegment=i)}},c=function(t,i,e,n){var s=Object.create(a);return s.init(t,i,e,n),s};i.default=c,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=e(7),r=n(o),a=e(8),c=n(a),h=e(10),l=n(h),u=e(13),d=n(u),f=e(14),y=(n(f),e(15)),v=(n(y),e(16)),p={init:function(t,i){"function"==typeof t?this.loop=t:i=t,this._gravityOn=!0,this.frames=[],this.waves=[],this.childWaves=[],this.bodies=[],this.points=[],this.anchors=[],this.width=i.width||600,this.height=i.height||300,this.nextBodyId=0,this.collisions=[],this.constraints=[],this.collideBoundary=void 0===i.collideBoundary||i.collideBoundary,console.log("can collide with boundary",this.collideBoundary),this.cellSize=this.calculateCellSize(i.cellSize||100),this.hash=this.initializeHash(this.cellSize,this.width,this.height),this._gravity=void 0===i.gravity?v.GRAVITY.LIGHT:i.gravity,this.broadphase=(0,c.default)(),this.narrowphase=(0,l.default)(),this.solver=(0,d.default)(),this.worldForce={x:0,y:0},this.currentRayId=0},calculateCellSize:function(t){var i=t?t:100;return this.width/Math.floor(this.width/i)},initializeHash:function(t,i,e){return(0,r.default)(t,i,e)},addChildWave:function(t){this.childWaves.push(t)},addObject:function(t){switch(t.type){case"rectangle":case"circle":case"polygon":t.id=this.nextBodyId++,this._gravityOn&&t.addForce(0,this.gravity),this.bodies.push(t);break;case"point":this.points.push(t);break;case"anchor":this.anchors.push(t);break;case"incident":case"wave":this.waves.push(t);break;case"link":case"boundary":this.constraints.push(t);break;default:throw new Error("tried to add something that you're totally not allowed to add")}},add:function(t){var i=this;"object"===("undefined"==typeof t?"undefined":s(t))&&void 0!==t.length?t.forEach(function(t){i.addObject(t)}):this.addObject(t)},remove:function(t){var i=this;if("object"===("undefined"==typeof t?"undefined":s(t))&&void 0!==t.length)t.forEach(function(t){var e=i.bodies.indexOf(t);e!==-1&&i.bodies.splice(e,1)});else{var e=this.bodies.indexOf(t);e!==-1&&this.bodies.splice(e,1)}return this},_integratePosition:function(t){this.bodies.forEach(function(i){i.static||i.update(t)})},_populateGrid:function(t){var i=this;this.bodies.forEach(function(t){i.hash.insertBody(t)})},_updateWorldForces:function(){var t=this;this.worldForceNeedsSet&&(this.bodies.forEach(function(i){i.setForce(t.worldForce.x,t.worldForce.y)}),this.worldForceNeedsSet=!1),this.worldForceNeedsUpdate&&(this.bodies.forEach(function(i){i.addForce(t.worldForce.x,t.worldForce.y)}),this.worldForceNeedsUpdate=!1)},_getCollisionPairs:function(){this.pairs=this.broadphase.getCollisionPairs(this.bodies,this.hash),this.pairs&&Object.keys(this.pairs).length>0&&(this.collisions=this.narrowphase.checkForCollisions(this.pairs))},update:function(t){var i=this;return this.hash.clear(),this._updateWorldForces(),this._integratePosition(t),this.loop&&this.loop(),this._populateGrid(),this._getCollisionPairs(),this.solver.solve(this.collisions,this.constraints,t),this.currentRayId=0,this.childWaves=[],this.waves.forEach(function(t){t.update(i),i.traverseWaves(t)}),this},traverseWaves:function(t){var i=this;0!==t.children.length&&t.children.forEach(function(t){i.addChildWave(t),i.traverseWaves(t)})},addWorldForce:function(t,i){this.worldForce.x+=t,this.worldForce.y+=i,this.worldForceNeedsUpdate=!0},setWorldForce:function(t,i){this.worldForce.x=t,this.worldForce.y=i,this.worldForceNeedsSet=!0}};Object.defineProperty(p,"gravityOn",{get:function(){return this._gravityOn},set:function(t){var i=this;this._gravityOn&&!t?(this._gravityOn=!1,this.worldForce.y-=this.gravity,this.bodies.forEach(function(t){t.addForce(0,-i.gravity)})):!this._gravityOn&&t&&(this._gravityOn=!0,this.worldForce.y+=this.gravity,this.bodies.forEach(function(t){t.addForce(0,i.gravity)}))}}),Object.defineProperty(p,"gravity",{get:function(){return this._gravity},set:function(t){var i=t-this._gravity;this.worldForce.y+=i,this._gravity+=i,this.bodies.forEach(function(t){t.addForce(0,i)})}});var x=function(t,i){var e=Object.create(p);return e.init(t,i),e};i.default=x,t.exports=i.default},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={init:function(t,i,e){this.cellSize=t,this.width=i,this.height=e,this.numRows=Math.ceil(e/t),this.numCols=i/t,this.contents={}},hash:function(t){return{col:Math.floor(t.x/this.cellSize),row:Math.floor(t.y/this.cellSize)}},insertBody:function(t){for(var i=this.hash(t.aabb.min),e=this.hash(t.aabb.max),n=i.row;n<e.row+1;n++)for(var s=i.col;s<e.col+1;s++)this.contents[n]?this.contents[n][s]?this.contents[n][s].push(t):this.contents[n][s]=[t]:(this.contents[n]={},this.contents[n][s]=[t])},updateBody:function(t){this.removeBody(t),this.insertBody(t)},removeBody:function(t){for(var i=this.hash(t.aabb.min),e=this.hash(t.aabb.max),n=i.row;n<e.row+1;n++)for(var s=i.col;s<e.col+1;s++){var o=this.contents[n][s].indexOf(t);o!==-1&&this.contents[n][s].splice(o,1)}},queryBody:function(t){for(var i=this.hash(t.aabb.min),e=this.hash(t.aabb.max),n=[],s=i.row;s<e.row+1;s++)for(var o=i.col;o<e.col+1;o++)this.contents[s][o].forEach(function(i){n.indexOf(i)===-1&&i!==t&&n.push(i)});return n},queryPoint:function(t){var i=this.hash(t);return i},clear:function(){this.contents={}}},n=function(t,i,n){var s=Object.create(e);return s.init(t,i,n),s};i.default=n,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(9),o=n(s),r={aabbOverlap:function(t,i){return t.aabb.overlap(i.aabb)},canCollide:function(t,i){return!(!t.canCollide||!i.canCollide)},getCollisionPairs:function(t,i){this.collisionCounter=0;for(var e={},n=0;n<t.length;n++)for(var s=t[n],r=i.queryBody(s),a=0;a<r.length;a++){var c=r[a];if(this.canCollide(s,c)&&this.aabbOverlap(s,c)){var h=void 0;h=s.id<c.id?s.id+"-"+c.id:c.id+"-"+s.id;var l=(0,o.default)(s,c,h);e[h]||(e[h]=l)}}return e}},a=function(t){var i=Object.create(r);return i};i.default=a,t.exports=i.default},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={init:function(t,i,e){this.bodies=[t,i],this.index=e}},n=function(t,i,n){var s=Object.create(e);return s.init(t,i,n),s};i.default=n,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=e(11),r=n(o),a={checkForCollisions:function(t){var i=[];if("object"===("undefined"==typeof t?"undefined":s(t))&&void 0===t.length)for(var e=Object.keys(t),n=0;n<e.length;n++){var o=t[e[n]],a=o.bodies[0],c=o.bodies[1],h=r.default.intersect(a,c);h&&(a.colliderList.push(h),c.colliderList.push(h),i.push(h))}else if("object"===("undefined"==typeof t?"undefined":s(t))&&t.length>0)for(var l=0;l<t.length;l++){var u=t[l],d=u.bodies[0],f=u.bodies[1],y=r.default.intersect(d,f);y&&(d.colliderList.push(y),i.push(y))}return i}},c=function(){var t=Object.create(a);return t};i.default=c,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(3),o=e(12),r=n(o),a={};a.projectBody=function(t,i){if("rectangle"===t.type||"polygon"===t.type){for(var e=t.vertices[0].scalarProjectUnit(i),n=e,s=0;s<t.vertices.length;s++){var o=t.vertices[s],r=o.scalarProjectUnit(i);r<e?e=r:r>n&&(n=r)}return{min:e,max:n}}if("circle"===t.type){var a=t.position.scalarProjectUnit(i);return{min:a-t.scaledRadius,max:a+t.scaledRadius}}},a.lineOverlap=function(t,i,e,n){return Math.max(0,Math.min(i,n)-Math.max(t,e))},a.intersect=function(t,i){return"rectangle"===t.type||"polygon"===t.type?"circle"===i.type?a.polycircle(t,i):a.polypoly(t,i):"circle"===t.type?"circle"===i.type?a.circlecircle(t,i):a.polycircle(t,i):void 0},a.circlecircle=function(t,i){var e=s.Vector.subtract(i.position,t.position),n=e.magnitude(),o=t.scaledRadius+i.scaledRadius;if(n<o){var a=s.Vector.subtract(i.position,t.position);return e.dot(a)>=0&&e.negate(),(0,r.default)(t,i,e.normalize(),o-n)}},a.polypoly=function(t,i){var e=[],n=void 0,o=void 0,a=t.vertices.length,c=i.vertices.length;"rectangle"===t.type&&(a=2);for(var h=0;h<a;h++){var l=t.vertices[h],u=t.vertices[h+1===t.vertices.length?0:h+1],d=s.Vector.subtract(l,u);d.normalize().perp(),e.push(d)}"rectangle"===i.type&&(c=2);for(var f=0;f<c;f++){var y=i.vertices[f],v=i.vertices[f+1===i.vertices.length?0:f+1],p=s.Vector.subtract(y,v);p.normalize().perp(),e.push(p)}for(var x=0;x<e.length;x++){var g=e[x],b=this.projectBody(t,g),m=this.projectBody(i,g),w=this.lineOverlap(b.min,b.max,m.min,m.max);if(0===w)return;n?w<n&&(n=w,o=g):(n=w,o=g)}var P=s.Vector.subtract(i.position,t.position);return o.dot(P)>=0&&o.negate(),(0,r.default)(t,i,o,n)},a.polycircle=function(t,i){var e=void 0,n=void 0;"circle"===t.type?(n=t,e=i):(n=i,e=t);for(var o=[],a=void 0,c=void 0,h=e.vertices.length,l=void 0,u=0;u<h;u++){var d=e.vertices[u],f=e.vertices[u+1===e.vertices.length?0:u+1],y=s.Vector.subtract(d,f);y.normalize().perp(),o.push(y);var v=s.Vector.subtract(d,n.position);l?v.magnitudeSq()<l.magnitudeSq()&&(l=v):l=v}o.push(l.normalize());for(var p=0;p<o.length;p++){var x=o[p],g=this.projectBody(e,x),b=this.projectBody(n,x),m=this.lineOverlap(g.min,g.max,b.min,b.max);if(0===m)return;a?m<a&&(a=m,c=x):(a=m,c=x)}var w=s.Vector.subtract(i.position,t.position);return c.dot(w)>=0&&c.negate(),(0,r.default)(t,i,c,a)},i.default=a,t.exports=i.default},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={init:function(t,i,e,n){this.body1=t,this.body2=i,this.mtvaxis=e,this.overlap=n,this.penetration={x:e.x*n,y:e.y*n}}},n=function(t,i,n,s){var o=Object.create(e);return o.init(t,i,n,s),o};i.default=n,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(3),o=n(s),r={INELASTIC:"inelastic",ELASTIC:"elastic",getCollisionType:function(t,i){return"inelastic"===t.collisionType||"inelastic"===i.collisionType?this.INELASTIC:this.ELASTIC},solveCollision:function(t){var i=t.body1,e=t.body2,n=t.mtvaxis,s=t.overlap,r=(0,o.default)(n.x*s,n.y*s),a=1;i.position.x+=r.x/2+.001,i.position.y+=r.y/2+.001,e.position.x-=r.x/2+.001,e.position.y-=r.y/2+.001,i.positionPrev=i.position.clone(),e.positionPrev=e.position.clone();var c=Math.max(i.restitution,e.restitution);i.positionPrev.x-=r.x/2*c*a,i.positionPrev.y-=r.y/2*c*a,e.positionPrev.x+=r.x/2*c*a,e.positionPrev.y+=r.y/2*c*a,i.updateVertices(),e.updateVertices()},solveCollisions:function(t){var i=this;t.forEach(function(t){return i.solveCollision(t)})},solveConstraints:function(t){t.forEach(function(t){return t.solve()})},solve:function(t,i,e){this.dt=e,this.solveConstraints(i),this.solveCollisions(t)}},a=function(){var t=Object.create(r);return t};i.default=a,t.exports=i.default},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={init:function(t,i,e,n,s){this.body1=t,this.body2=i,this.bounds=e,this.distance=n,this.forces=s}},n=function(){var t=arguments.length<=0?void 0:arguments[0],i=Object.create(e);switch(i.type=arguments.length<=0?void 0:arguments[0],t){case"boundary":i.init(arguments.length<=1?void 0:arguments[1],null,arguments.length<=3?void 0:arguments[3],null,null);break;case"link":i.init(arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],null,arguments.length<=3?void 0:arguments[3],null);break;default:throw new Error("I don't know how to handle that kind of constraint!")}return i};i.default=n,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(14),o=n(s),r=(e(3),function(t,i,e){var n=(0,o.default)("boundary",t,null,i,e);return n.solve=function(){var e=t.aabb.min.x,n=t.aabb.min.y,s=t.aabb.max.x,o=t.aabb.max.y;switch(t.type){case"circle":var r=t.aabb.min.x,a=t.aabb.min.y,c=t.aabb.max.x,h=t.aabb.max.y,l=t.radius;r<0&&t.setX(l),a<0&&t.setY(l),c>i.width&&t.setX(i.width-l),h>i.height&&t.setY(i.height-l);break;case"rectangle":var u=s-e,d=o-n;e<0&&t.setX((u-t.width)/2),n<0&&t.setY(d-t.height)/2,s>i.width&&t.setX(i.width-t.width-(u-t.width)/2),o>i.height&&t.setY(i.height-t.height-(d-t.height)/2);break;case"polygon":var f=s-e,y=o-n;e<0&&t.setX(0),n<0&&t.setY(0),s>i.width&&t.setX(i.width-t.width-(f-t.width)/2),o>i.height&&t.setY(i.height-t.height-(y-t.height)/2)}},n});i.default=r,t.exports=i.default},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={LIGHT:4e-5,MEDIUM:1e-4,HEAVY:4e-4},n={Rock:{density:.6,restitution:.1},Wood:{density:.3,restitution:.2},Metal:{density:1.2,restitution:.05},BouncyBall:{density:.3,restitution:.8},SuperBall:{density:.3,restitution:.95},Pillow:{density:.1,restitution:.2},Static:{density:0,restitution:.4}};i.MATERIALS=n,i.GRAVITY=e},function(t,i,e){"use strict";function n(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}Object.defineProperty(i,"__esModule",{value:!0});var s=e(4),o=n(s),r={init:function(t,i){this.clearBackground=void 0===i.clearBackground||i.clearBackground,console.log(this.clearBackground),this.background=i.background||"black",this.borderColor=i.borderColor,this.system=t,this.canvas="undefined"==typeof i.canvas?function(){var t=document.createElement("canvas");return t.id="canvas",document.body.appendChild(t),t}():function(){var t=document.getElementById(i.canvas);return t}(),this.canvas.width=this.system.width,this.canvas.height=this.system.height,this.ctx=this.canvas.getContext("2d"),this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.frameTimestep=0,this.fps=60,this.dt=1e3/this.fps,this.debug=void 0!==i.debug&&i.debug,this.debug&&(window.renderer=this,window.ctx=this.canvas.getContext("2d"))},resize:function(t,i,e){this.canvas.width=t,this.canvas.height=i,this.system.width=t,this.system.height=i,this.system.cellSize=this.system.calculateCellSize(e||this.system.cellSize),this.system.hash=this.system.initializeHash(this.system.cellSize,t,i)},drawPoint:function(t){this.ctx.beginPath(),this.ctx.ellipse(t.position.x,t.position.y,3,3,0,0,2*Math.PI),this.ctx.strokeStyle="red",this.ctx.lineWidth=1,this.ctx.stroke()},drawConstraints:function(t){var i=this;t.forEach(function(t){return i.drawConstraint(t)})},drawConstraint:function(t){switch(t.type){case"link":this.ctx.beginPath(),this.ctx.moveTo(t.body1.centroid.x,t.body1.centroid.y),this.ctx.lineTo(t.body2.centroid.x,t.body2.centroid.y),this.ctx.stroke()}},drawBodies:function(t){var i=this;t.forEach(function(t){return i.drawBody(t)})},drawBody:function(t,i){var e=this;if(t.debug){if("circle"===t.type){this.ctx.beginPath();var n=t.position.x,s=t.position.y,o=Math.cos(t.rotation)*t.radius,r=Math.sin(t.rotation)*t.radius;this.ctx.moveTo(n,s),this.ctx.lineTo(n+o,s+r),this.ctx.strokeStyle="red",this.ctx.stroke()}this.ctx.beginPath();var a=t.aabb,c=a.min.x,h=a.min.y,l=a.max.x-c,u=a.max.y-h;this.ctx.rect(c,h,l,u),this.ctx.strokeStyle="red",this.ctx.lineWidth=.5,this.ctx.stroke()}if(this.debug){this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="red",this.ctx.lineWidth=1;var d=t.aabb,f=d.min.x,y=d.min.y,v=d.max.x-f,p=d.max.y-y;this.ctx.rect(f,y,v,p),this.ctx.stroke(),t.vertices&&t.vertices.forEach(function(t){e.ctx.beginPath(),e.ctx.strokeStyle="magenta",e.ctx.lineWidth=2,e.ctx.ellipse(t.x,t.y,4,4,0,0,2*Math.PI),e.ctx.stroke()}),t.centroid&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.ellipse(t.centroid.x,t.centroid.y,3,3,0,0,2*Math.PI),this.ctx.stroke())}switch(this.ctx.beginPath(),this.ctx.globalAlpha=1,t.type){case"rectangle":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.lineJoin="miter",t.debug&&(t.colliderList.length>0?this.ctx.strokeStyle="green":this.ctx.strokeStyle="white"),this.ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(var x=1;x<t.vertices.length;x++){var g=t.vertices[x];this.ctx.lineTo(g.x,g.y)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();break;case"circle":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,t.debug&&(t.colliderList.length>0?this.ctx.strokeStyle="green":this.ctx.strokeStyle="white"),this.ctx.ellipse(t.position.x,t.position.y,t.scaledRadius,t.scaledRadius,0,0,2*Math.PI),this.ctx.stroke();break;case"polygon":this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.lineJoin="miter",this.ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(var b=1;b<t.vertices.length;b++){var m=t.vertices[b];this.ctx.lineTo(m.x,m.y)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}},drawWave:function(t){var i="DEGREES"===t.mode?o.degToRad(t.direction):t.direction;this.ctx.fillStyle=t.style.fillStyle,this.ctx.lineWidth=t.style.lineWidth,this.ctx.strokeStyle=t.style.strokeStyle,this.ctx.globalAlpha=o.map(t.intensity,0,1,.1,1),this.debug&&("incident"===t.type?(this.ctx.beginPath(),this.ctx.fillStyle="yellow",this.ctx.ellipse(t.position.x,t.y,3,3,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.strokeStyle="green"):"refracted"===t.type?this.ctx.strokeStyle="blue":"reflected"===t.type&&(this.ctx.strokeStyle="orange")),this.ctx.beginPath(),this.ctx.moveTo(t.position.x,t.position.y),t.ray.intersectionPoint?(this.ctx.lineTo(t.ray.intersectionPoint.x,t.ray.intersectionPoint.y),this.ctx.stroke(),this.debug&&(this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.lineWidth=.5,this.ctx.ellipse(t.ray.intersectionPoint.x,t.ray.intersectionPoint.y,3,3,0,0,2*Math.PI),this.ctx.stroke())):(this.ctx.lineTo(2e3*Math.cos(i)+t.position.x,2e3*Math.sin(i)+t.position.y),this.ctx.stroke())},run:function(){var t=this;this.lastTick=0;var i=function i(e){t._requestID=window.requestAnimationFrame(i),e&&t.tick(e)};i()},tick:function(t){var i=t-this.lastTick;for(this.frameTimestep+=i,this.lastTick=t,this.frameTimestep>50&&(this.frameTimestep=50);this.frameTimestep>this.dt;)this.system.update(this.dt),this.frameTimestep-=this.dt;var e=this.frameTimestep/this.dt;this.render(e)},drawBackground:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.globalAlpha=1,this.ctx.lineWidth=1,this.ctx.fillStyle=this.background,this.ctx.strokeStyle=this.borderColor,this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.fill(),this.ctx.stroke()},render:function(t){var i=this;this.clearBackground&&this.drawBackground(),this.drawBodies(this.system.bodies),this.drawConstraints(this.system.constraints),this.debug&&this.system.anchors.forEach(function(t){i.drawPoint(t)}),this.system.waves.forEach(function(e){i.drawWave(e,t)}),this.system.childWaves.forEach(function(e){i.drawWave(e,t)}),this.debug===!0&&!function(){var t=i.system.hash.cellSize;i.ctx.globalAlpha=1,i.ctx.lineWidth=1;for(var e=0;e<i.system.hash.width;e+=t)for(var n=0;n<i.system.hash.height;n+=t)i.ctx.beginPath(),i.ctx.strokeStyle="green",i.ctx.rect(e,n,t,t),i.ctx.stroke();Object.keys(i.system.hash.contents).forEach(function(e){Object.keys(i.system.hash.contents[e]).forEach(function(n){0!==i.system.hash.contents[e][n].length&&(i.ctx.beginPath(),i.ctx.strokeStyle="red",i.ctx.lineWidth=1,i.ctx.rect(n*t,e*t,t,t),i.ctx.stroke())})})}()},setSize:function(t,i){this.canvas.width=t,this.canvas.height=i},stop:function(){cancelAnimationFrame(this._requestID)},start:function(){this.render(this.system)}},a=function(t,i){var e=Object.create(r);return e.init(t,i),e};i.default=a,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(19),o=n(s),r=e(21),a=n(r),c=e(3),h=(n(c),function(t){t=t||{};var i=Object.create(o.default);return i.init(t),i.type="rectangle",i._mode=t.mode||"LEFT",i.inertia=i.mass/12*(i.height*i.height+i.width*i.width),i.invInertia=1/i.inertia,Object.defineProperty(i,"mode",{get:function(){return this._mode},set:function(t){if(this._mode!==t&&"rectangle"===this.type)switch(t){case"LEFT":case"CENTER":case"RIGHT":this._mode=t,this.updateVertices();break;default:console.warn("Cannot set mode to "+t)}else console.warn("'mode' is only available on rectangles")}}),i.isPointInterior=function(t,e){var n=i.position.x,s=i.position.y;return t>=n&&t<=n+i.width&&e>=s&&e<=s+i.height},i.updateVertices(),i.aabb=(0,a.default)(i),i});i.default=h,t.exports=i.default},function(t,i,e){"use strict";function n(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=e(20),a=s(r),c=e(3),h=s(c),l=e(4),u=(n(l),{init:function(t){return t=t||{},0===Object.keys(t).length&&t.constructor===Object&&console.warn("You probably should initialize body objects with some values...just sayin"),this.style={fillStyle:t.fillStyle||"rgba(0,0,0,0)",lineWidth:t.lineWidth||2,strokeStyle:t.strokeStyle||"#abcabc"},this.height=t.height||10,this.width=t.width||10,this._mass=t.mass||1,this.invMass=1/this._mass,this.positionImpulse={x:0,y:0},this.position=(0,h.default)(t.x||0,t.y||0),this.positionPrev=this.position.clone(),this.interpolatedPosition=this.position.clone(),this.velocity=(0,h.default)(t.velocity&&t.velocity.x||0,t.velocity&&t.velocity.y||0),this.force=(0,h.default)(t.force&&t.force.x||0,t.force&&t.force.y||0),this.torque=void 0===t.torque?0:t.torque,this._scale=1,
this._rotation=void 0===t.rotation?0:t.rotation,this.interpolatedRotation=this.rotation,this.rotationPrev=this._rotation,this.angularVelocity=void 0===t.angularVelocity?0:t.angularVelocity,this.static=t.static===!0,this.canCollide=t.canCollide!==!1,this.collisionType=t.collisionType||"elastic",this.colliderList=[],this.restitution=1,this.refractiveIndex=t.refractiveIndex||1,this.material=t.material||"GLASS",this.materialColor=t.fillStyle||"black",this.mirror=t.mirror||!1,this.intersectionPoints={},this.debug=void 0!==t.debug&&t.debug,t.material&&t.refractiveIndex?(this.refractiveIndex=t.refractiveIndex,this.material=t.material,console.warn("Setting both the material and the refractive index at the same time may cause some unexpected behavior")):t.material?a.default[this.material]?this.refractiveIndex=a.default[this.material].refractiveIndex:void 0===this.material||null===this.material?(this.material="default",this.refractiveIndex=1):console.error("the material "+this.material+" is not recognized. See the docs for supported default materials"):t.refractiveIndex?this.refractiveIndex=t.refractiveIndex:this.refractiveIndex=1.33,this},freeze:function(){return this.setPosition(this.position.x,this.position.y),this},unfreeze:function(){return this.static=!1,this},translate:function(){return 1===arguments.length?"object"===o(arguments.length<=0?void 0:arguments[0])&&this.position.add(arguments.length<=0?void 0:arguments[0]):2===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&(this.position.x+=arguments.length<=0?void 0:arguments[0],this.position.y+=arguments.length<=1?void 0:arguments[1]),this.updateVertices&&this.updateVertices(),this},rotate:function(t){return this.rotation+=t,this},updateVertices:function(){var t=this;switch(this.type){case"rectangle":var i=this.width,e=this.height,n=this.position.x,s=this.position.y;switch(this._mode){case"CENTER":n-=i/2,s-=e/2;break;case"RIGHT":n-=i}this.centroid=(0,h.default)((n+(n+i))/2,(s+(s+e))/2),this.vertices=[(0,h.default)(n,s),(0,h.default)(n+i,s),(0,h.default)(n+i,s+e),(0,h.default)(n,s+e)],0===this.angularVelocity&&0===this._rotation&&0===this._scale||this.vertices.forEach(function(i){i.translate(-t.centroid.x,-t.centroid.y).rotate(t._rotation).multiply(t._scale).translate(t.centroid.x,t.centroid.y)});break;case"polygon":this.centroid={x:0,y:0},this.vertices.forEach(function(i,e){var n=t._relativeVertices[e];i.x=n.x+t.position.x,i.y=n.y+t.position.y,t.centroid.x+=i.x,t.centroid.y+=i.y}),this.centroid.x/=this.vertices.length,this.centroid.y/=this.vertices.length,0===this.angularVelocity&&0===this._rotation&&0===this._scale||this.vertices.forEach(function(i){i.translate(-t.centroid.x,-t.centroid.y).rotate(t._rotation).multiply(t._scale).translate(t.centroid.x,t.centroid.y)});break;case"circle":this.centroid={x:this.position.x,y:this.position.y}}this.aabb&&this.aabb.update()},addForce:function(t,i){this.force.x+=t,this.force.y+=i},setForce:function(t,i){this.force.x=t,this.force.y=i},setPosition:function(t,i){this.position.x=t,this.position.y=i,this.positionPrev.x=t,this.positionPrev.y=i},setX:function(t){this.position.x=t,this.positionPrev.x=t},setY:function(t){this.position.y=t,this.positionPrev.y=t},setRotation:function(t){this.rotation=t,this.rotationPrev=t},update:function(t){var i=t*t;this.colliderList.length>0;var e=this.position.x-this.positionPrev.x,n=this.position.y-this.positionPrev.y;return this.velocity.x=e+this.force.x*this.invMass*i,this.velocity.y=n+this.force.y*this.invMass*i,this.angularVelocity=this.rotation-this.rotationPrev+this.torque*this.invInertia*i,this.positionPrev.x=this.position.x,this.positionPrev.y=this.position.y,this.position.add(this.velocity),this.rotationPrev=this.rotation,this.rotation+=this.angularVelocity*i,this.updateVertices&&this.updateVertices(),this.intersectionPoints={},this.colliderList=[],this}});Object.defineProperty(u,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateVertices&&this.updateVertices()}}),Object.defineProperty(u,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateVertices?this.updateVertices():"circle"===this.type&&(this.scaledRadius=this.radius*t)}}),Object.defineProperty(u,"mass",{get:function(){return this._mass},set:function(t){this._mass=t,this.invMass=1/t}}),i.default=u,t.exports=i.default},function(t,i){t.exports={GLASS:{refractiveIndex:1.5},AIR:{refractiveIndex:1.000277}}},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n={init:function(t){this.body=t;var i=this.findMinMax(t),e=i.min,n=i.max;this.max=n,this.min=e},findMinMax:function(){var t=this;if(!this.body.vertices){var i=this.body.position.x,n=this.body.position.y,s=this.body.scaledRadius;return{max:{x:i+s,y:n+s},min:{x:i-s,y:n-s}}}var o=function(){var i=void 0,e=void 0,n=void 0,s=void 0;return t.body.vertices.forEach(function(t){var o=t.x,r=t.y;"undefined"==typeof i?i=o:"undefined"!=typeof i&&o<i&&(i=o),"undefined"==typeof e?e=r:"undefined"!=typeof e&&r<e&&(e=r),"undefined"==typeof n?n=o:"undefined"!=typeof n&&o>n&&(n=o),"undefined"==typeof s?s=r:"undefined"!=typeof s&&r>s&&(s=r)}),{v:{max:{x:n,y:s},min:{x:i,y:e}}}}();if("object"===("undefined"==typeof o?"undefined":e(o)))return o.v},contains:function(t){var i=t.x,e=t.y;return i>=this.min.x&&i<=this.max.x&&e>=this.min.y&&e<=this.max.y},overlap:function(t){return!(this.max.x<t.min.x)&&(!(this.min.x>t.max.x)&&(!(this.max.y<t.min.y)&&!(this.min.y>t.max.y)))},update:function(){var t=this.findMinMax(),i=t.max,e=t.min;this.max=i,this.min=e}},s=function(t){var i=Object.create(n);return i.init(t),i};i.default=s,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=(e(4),e(3)),o=n(s),r=e(5),a=n(r),c={init:function(t){t=t||{};var i=299792458;this.children=[],this.style={lineWidth:t.lineWidth||1,strokeStyle:t.strokeStyle||"#456abc",opacity:t.opacity||1},this.x=t.x||10,this.y=t.y||10,this.position=(0,o.default)(t.x,t.y),this.waveSpeed=t.waveSpeed||i,this.frequency=t.frequency||1e3,this.wavelength=this.waveSpeed/this.frequency,this.velocity=t.velocity||(0,o.default)(0,0),this.direction=t.direction||0,this.mode=t.mode||"RADIAN",this.intensity=t.intensity||1,this.type=t.type||"incident",this.parent=t.parent||null,this.n1=t.n1||1,this.n2=t.n2||1,this.lastIntersection={},this.ray=(0,a.default)(this.position.x,this.y,this.direction,"DEGREES"===this.mode||null)},update:function(t){this.ray.trace(t),this.children=[],this.ray.intersectionPoint&&(this.lastIntersection=this.ray.intersectionPoint,this.children=this.createChildren(),this.children.forEach(function(i){i.update(t)}))},createChildren:function(){var t=this,i=void 0,e=this.ray.intersectingBody.type;"rectangle"===e||"polygon"===e?!function(){var e=t.ray.intersectingSegment;e.normalize();var n=(e.dot(t.ray.direction),[(0,o.default)(-e.y,e.x),(0,o.default)(e.y,-e.x)]),s=t;n.forEach(function(t){t.dot(s.ray.direction)<0&&(i=t)})}():"circle"===e&&!function(){var e=t.ray.intersectingBody.position.x,n=t.ray.intersectingBody.position.y,s=t.ray.intersectionPoint.x,r=t.ray.intersectionPoint.y,a=(0,o.default)(s-e,r-n),c=(0,o.default)(e-s,n-r);a.normalize(),c.normalize();var h=[a,c],l=t;h.forEach(function(t){t.dot(l.ray.direction)<0&&(i=t)}),void 0===i&&(i=h[0])}();var n=(2*this.ray.direction.dot(i),i.clone());n.multiply(2*this.ray.direction.dot(i));var r=this.ray.direction.clone();if(r.subtract(n),"incident"===this.type&&this.ray.outerBodies.length>0&&(this.n1=this.ray.outerBodies[this.ray.outerBodies.length-1].refractiveIndex),this.ray.intersectingBody)switch(this.type){case"refracted":this.parent&&this.parent.ray.intersectingBody&&this.parent.ray.intersectingBody===this.ray.intersectingBody?(this.n1=this.parent.n2,this.n2=this.parent.n1):(this.n1=this.parent.n2,this.n2=this.ray.intersectingBody.refractiveIndex);break;case"reflected":this.parent&&this.parent.ray.intersectingBody&&this.parent.ray.intersectingBody===this.intersectingBody?(this.n1=this.parent.n1,this.n2=this.parent.n2):(this.n1=this.parent.n1,this.n2=this.ray.intersectingBody.refractiveIndex);break;case"incident":this.n2=this.ray.intersectingBody.refractiveIndex}else this.n1=1,this.n2=1;var a=Math.PI-this.ray.direction.angleTo(i),c=Math.asin(this.n1*Math.sin(a)/this.n2),l=this.n1/this.n2*(this.n1/this.n2)*(1-Math.cos(a)*Math.cos(a)),u=s.Vector.multiply(this.n1/this.n2,this.ray.direction),d=s.Vector.multiply(i,this.n1/this.n2*Math.cos(a)-Math.sqrt(1-l));u.add(d);var f=(this.n1-this.n2)/(this.n1+this.n2),y=f*f,v=void 0;this.n1<=this.n2?v=1-(Math.cos(a)<0?-Math.cos(a):Math.cos(a)):this.n1>this.n2&&(v=1-(Math.cos(c)<0?-Math.cos(c):Math.cos(c)));var p=y+(1-y)*Math.pow(v,5),x=1-p;Math.sin(a)>this.n2/this.n1&&(p=.95,x=0),this.ray.intersectingBody.mirror===!0&&(p=.9,x=0);var g=this.intensity*p,b=this.intensity*x,m=r.getAngle(),w=u.getAngle(),P=[];if(g>.01){var _=h({x:this.ray.intersectionPoint.x+Math.cos(m),y:this.ray.intersectionPoint.y+Math.sin(m),direction:m,intensity:g,type:"reflected",parent:this,n1:this.n1,n2:this.n2,lineWidth:this.style.lineWidth,strokeStyle:this.style.strokeStyle});P.push(_)}if(b>.01){var S=h({x:this.ray.intersectionPoint.x-i.x,y:this.ray.intersectionPoint.y-i.y,direction:w,intensity:b,type:"refracted",parent:this,n1:this.n1,n2:this.n2,lineWidth:this.style.lineWidth,strokeStyle:this.style.strokeStyle});P.push(S)}return P}},h=function(t){var i=Object.create(c);return i.init(t),i};i.default=h,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(19),o=n(s),r=e(21),a=n(r),c=e(4),h=function(t){t=t||{};var i=Object.create(o.default);return i.init(t),i.radius=t.radius||10,i.scaledRadius=i.radius,i.type="circle",i.aabb=(0,a.default)(i),i.inertia=i.mass*i.radius*i.radius/2,i.invInertia=1/i.inertia,i.isPointInterior=function(t,e){var n=i.position.x,s=i.position.y;return(0,c.distance)(t,e,n,s)<=i.scaledRadius},i};i.default=h,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(19),o=n(s),r=e(21),a=n(r),c=e(3),h=n(c),l=function(t){t=t||{};var i=Object.create(o.default);if(!t.vertices)throw new Error("Polygons MUST be initialized with vertices. See docs.");return i.init(t),i.type="polygon",i.inertia=1,i.invInertia=1/i.inertia,i._relativeVertices=[],i.vertices=[],t.vertices.forEach(function(e){i._relativeVertices.push((0,h.default)(e.x,e.y)),i.vertices.push((0,h.default)(t.x+e.x,t.y+e.y))}),i.isPointInterior=function(t,e){for(var n=!1,s=0,o=i.vertices.length-1;s<i.vertices.length;o=s++){var r=i.vertices[s],a=i.vertices[o],c=r.x,h=r.y,l=a.x,u=a.y,d=h>e!=u>e&&t<(l-c)*(e-h)/(u-h)+c;d&&(n=!n)}return n},i.updateVertices(),i.aabb=(0,a.default)(i),i};i.default=l,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(3),o=n(s),r={init:function(t,i){this.position=(0,o.default)(t,i),this.type="anchor",this.static=!0,this.centroid={x:this.position.x,y:this.position.y}}},a=function(t,i){var e=Object.create(r);return e.init(t,i),e};i.default=a,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(14),o=n(s),r=e(3),a=(n(r),function(t,i,e){var n=(0,o.default)("link",t,i,e);return n.type="link",n.solve=function(){if("point"===i.type){var e=i.position.clone();e.subtract(t.interpolatedPosition);var n=t.velocity,s=t.force,o=t.mass,r=(e.dot(s)-n.dot(n)*o)/e.dot(e);({x:e.x*r,y:e.y*r})}},n});i.default=a,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var s=e(3),o=n(s),r=e(28),a={intersect:function(t,i){if("rectangle"===t.type){if("rectangle"===i.type||"polygon"===i.type)return this.polypoly(t,i);if("circle"===i.type)return this.polycircle(t,i)}if("circle"===t.type){if("rectangle"===i.type||"polygon"===i.type)return this.polycircle(i,t);if("circle"===i.type)return this.circlecircle(t,i)}if("polygon"===t.type){if("rect"===i.type||"polygon"===i.type)return polypoly(t,i);if("circle"===i.type)return this.polycircle(t,i)}},polypoly:function(t,i){},polycircle:function(t,i){},circlecircle:function(t,i){},pointPoly:function(t,i,e){var n=Object.create(r.Simplex),a=(0,o.default)(i,e),c=t.vertices,h=Math.floor(Math.random()*c.length);n.evolve(c[h]);var l=n.getSearchDirection(),u=n.calculateSupportPoint(l,c);n.evolve(c[u]);var d=n.line(i,e);l=s.Vector.subtract(a,d),support=this.calculateSupportPoint(l,c),n.vertexC=support.clone()},calculateSupportPoint:function(t,i){for(var e=0,n=i[e].dot(t),s=1;s<i.length;s++){var o=i[s].dot(t);o>n&&(e=s,n=o)}return i[e]},getVoronoiRegions:function(t){}};i.default=a,t.exports=i.default},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.Simplex=void 0;var s=e(3),o=(n(s),i.Simplex={evolve:function(t){if(!(this.count<2))throw new Error("cannot evolve a simplex beyond 3 points");void 0===this.vertexA?this.vertexA=o(t):void 0===this.vertexB?this.vertexB=o(t):void 0===this.vertexC&&(this.vertexC=o(t)),this.count++},getSupportPoint:function(t,i){for(var e=0,n=i[e].dot(t),s=1;s<i.length;s++){var o=i[s].dot(t);o>n&&(e=s,n=o)}return e},getSearchDirection:function(){switch(this.count){case 1:return s.Vector.negate(this.vertexA);case 2:s.Vector.subtract(vertexB.point,vertexA.point)}},getClosestPoint:function(){},getWitnessPoints:function(t,i){},solve2:function(t){},solve3:function(t){},divisor:0,count:0},function(t,i,e,n,o){return{point1:t,point2:i,point:s.Vector.subtract(t,i),index1:n,index2:o}})},function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={ELASTIC:"elastic",INELASTIC:"inelastic",STATIC:"static"},t.exports=i.default}])});